# PR #15: Canvas Ownership & URL-Based Sharing

**Branch Name:** `pr-15-canvas-sharing`  
**Goal:** Add canvas ownership with URL-based sharing (anyone with link can access)  
**Risk Level:** ⚠️ **MEDIUM** (requires Firebase restructure but simpler than explicit sharing)  
**Estimated Time:** 8-10 hours

---

## Key Design Decisions

### URL-Based Sharing Model
- **No explicit "share" button** - just copy/paste the URL
- Any authenticated user with the canvas URL can access it
- First time a user opens a canvas, it's automatically added to their "shared with me" list
- Users can leave shared canvases to remove them from their list (canvas still exists)
- Owners cannot leave their own canvas - they must delete it instead
- Similar to Google Docs "anyone with the link" mode

### Data Tracking
- Track when each user last opened each canvas (for sorting)
- Track who owns each canvas (for permission checks)
- Show canvases sorted by most recently opened

---

## New Firebase Data Structure

```
/canvases/{canvasId}
  id: string
  name: string
  ownerId: string
  createdAt: timestamp
  updatedAt: timestamp
  lastOpenedBy: {
    userId1: timestamp,
    userId2: timestamp,
    ...
  }
  
/objects/{canvasId}/{objectId}
  (existing rectangle data with all properties)
  
/presence/{canvasId}/{userId}
  (existing presence data)

/users/{userId}
  email: string
  color: string
  createdAt: timestamp
```

**Note:** No migration needed - old data at `/objects` root level will not appear in new canvas list.

**Note:** Canvas thumbnails are out of scope - removed from data structure.

---

## Phase 1: Backend Structure & Types (1.5 hours)

- [x] **Task 15.1:** Update TypeScript types
  - **Files Modified:**
    - `src/types/index.ts`
  - **What to Add:**
  - Create a Canvas interface representing the metadata for a canvas document
  - Canvas should include: unique ID, name chosen by user, owner's user ID, creation timestamp, last update timestamp
  - Canvas should track which users have opened it and when (map of user IDs to timestamps)
  - Create a CanvasListItem interface that extends Canvas with additional computed properties
  - CanvasListItem should indicate whether the current user owns this canvas
  - CanvasListItem should include the timestamp when current user last opened this canvas
  - Keep all existing interfaces (Rectangle, User, PresenceUser, etc.) unchanged

- [x] **Task 15.2:** Update Firebase security rules
  - **Files Modified:**
    - `database.rules.json`
  - **What to Change:**
  - User data should be readable by any authenticated user, writable only by the user themselves
  - Canvas metadata should be readable by any authenticated user (enables URL-based sharing)
  - Canvas metadata should only be writable when creating new canvas OR by the owner
  - Objects within a canvas should be readable and writable by any authenticated user who has the canvas URL
  - Presence data should be readable by any authenticated user, writable only by the user themselves
  - Add validation to ensure objects have required fields like position, size, color, creator info

- [x] **Task 15.3:** Create canvas utility functions
  - **Files Created:**
    - `src/utils/canvases.ts`
  - **What Functions to Create:**
  - Function to create a new canvas with a name and owner ID, returns the new canvas ID
  - Function to retrieve canvas metadata by canvas ID, returns null if not found
  - Function to update the "last opened" timestamp for a specific user on a specific canvas
  - Function to get all canvases that a user can see (either they own it OR they've opened it before), sorted by most recently opened first
  - Function to search through a user's accessible canvases by name using simple text matching
  - Function to rename a canvas (should only work if user is owner)
  - Function to delete a canvas and all its associated data (should only work if user is owner)
  - Function to check if a canvas exists and is accessible
- **Implementation Notes:**
  - When creating a canvas, automatically record that the owner opened it at creation time
  - When getting user's canvases, combine owned canvases and canvases they've accessed
  - Search should be case-insensitive and match anywhere in the canvas name
  - Deleting a canvas should also delete all objects and presence data for that canvas

---

## Phase 2: Context Updates (2 hours)

- [x] **Task 15.4:** Create CanvasListContext
  - **Files Created:**
    - `src/contexts/CanvasListContext.tsx`
    - `src/hooks/useCanvasList.ts`
  - **What the Context Should Provide:**
    - A list of all canvases accessible to the current user
    - A loading state indicating whether canvases are being fetched
    - The current search query text
    - A function to update the search query
    - A function to create a new canvas
    - A function to delete a canvas
    - A function to rename a canvas
    - A function to leave a shared canvas (remove from user's list)
    - A function to manually refresh the canvas list
  - **Behavior:**
    - When the component mounts or user changes, automatically load all accessible canvases
    - When search query changes, debounce for 300ms then filter the canvas list
    - After creating, deleting, renaming, or leaving, automatically refresh the canvas list
    - Separate canvases into "owned by me" and "shared with me" based on owner ID
    - Sort all canvases by the timestamp when current user last opened them
  - **Hook Implementation:**
    - The hook should throw an error if used outside the provider
    - The hook should make it easy to access all canvas list functionality

- [ ] **Task 15.5:** Update CanvasContext to work with canvas IDs
  - **Files Modified:**
    - `src/contexts/CanvasContext.tsx`
  - **What to Change:**
    - The provider should now require a canvas ID as a prop
    - All Firebase database paths for objects should include the canvas ID
    - Objects should be scoped to the specific canvas ID
    - Creating an object should save it under the canvas-specific path
    - Updating an object should update it under the canvas-specific path
    - Deleting an object should remove it from the canvas-specific path
    - When canvas ID changes, reinitialize all Firebase listeners with new paths
    - Keep all existing optimistic update and conflict resolution logic
    - All other functionality (selection, creation, deletion) should work identically

- [x] **Task 15.6:** Update PresenceContext to work with canvas IDs
  - **Files Modified:**
    - `src/contexts/PresenceContext.tsx`
  - **What to Change:**
    - The provider should now require a canvas ID as a prop
    - All Firebase database paths for presence should include the canvas ID
    - Presence should be scoped to the specific canvas ID
    - When a user joins a canvas, write their presence to the canvas-specific path
    - When a user leaves or disconnects, remove presence from canvas-specific path
    - Listen to presence updates only for the current canvas
    - When canvas ID changes, disconnect from old canvas and connect to new one
    - Keep all existing cursor tracking and throttling logic
    - Keep existing user color assignment logic
  - A list of all canvases accessible to the current user
  - A loading state indicating whether canvases are being fetched
  - The current search query text
  - A function to update the search query
  - A function to create a new canvas
  - A function to delete a canvas
  - A function to rename a canvas
  - A function to manually refresh the canvas list
- **Behavior:**
  - When the component mounts or user changes, automatically load all accessible canvases
  - When search query changes, debounce for 300ms then filter the canvas list
  - After creating, deleting, or renaming, automatically refresh the canvas list
  - Separate canvases into "owned by me" and "shared with me" based on owner ID
  - Sort all canvases by the timestamp when current user last opened them
- **Hook Implementation:**
  - The hook should throw an error if used outside the provider
  - The hook should make it easy to access all canvas list functionality

- [x] **Task 15.5:** Update CanvasContext to work with canvas IDs
  - **Files Modified:**
    - `src/contexts/CanvasContext.tsx`
  - **What to Change:**
  - The provider should now require a canvas ID as a prop
  - All Firebase database paths for objects should include the canvas ID
  - Objects should be scoped to the specific canvas ID
  - Creating an object should save it under the canvas-specific path
  - Updating an object should update it under the canvas-specific path
  - Deleting an object should remove it from the canvas-specific path
  - When canvas ID changes, reinitialize all Firebase listeners with new paths
  - Keep all existing optimistic update and conflict resolution logic
  - All other functionality (selection, creation, deletion) should work identically

### Task 15.6: Update PresenceContext to work with canvas IDs ✅
- **Files Modified:**
  - `src/contexts/PresenceContext.tsx`
- **What to Change:**
  - The provider should now require a canvas ID as a prop
  - All Firebase database paths for presence should include the canvas ID
  - Presence should be scoped to the specific canvas ID
  - When a user joins a canvas, write their presence to the canvas-specific path
  - When a user leaves or disconnects, remove presence from canvas-specific path
  - Listen to presence updates only for the current canvas
  - When canvas ID changes, disconnect from old canvas and connect to new one
  - Keep all existing cursor tracking and throttling logic
  - Keep existing user color assignment logic

---

## Phase 3: Routing & Navigation (1 hour)

### Task 15.7: Add React Router ✅
- **Files Modified:**
  - `package.json`
  - `src/App.tsx`
- **What to Do:**
  - Install react-router-dom as a dependency
  - Wrap the entire application in a router
  - Define route for "/" that shows the canvas list page
  - Define route for "/canvas/:canvasId" that shows the canvas editor
  - Define catch-all route that redirects unknown paths to the home page
  - Keep existing provider hierarchy (UserProvider, AuthProvider wrapping everything)

### Task 15.8: Update App component structure ✅
- **Files Modified:**
  - `src/App.tsx`
- **What to Change:**
  - Remove any direct rendering of Canvas, Toolbar, or OnlineUsers components
  - App should only handle routing between different pages
  - Add CanvasListProvider wrapping the routes (but inside AuthProvider)
  - The authenticated content should now be the router with different pages
  - Move all canvas-related rendering to a separate CanvasEditor page component

---

## Phase 4: Canvas List UI (3 hours)

### Task 15.9: Create CanvasListPage component ✅
- **Files Created:**
  - `src/pages/CanvasListPage.tsx`
- **What the Page Should Show:**
  - A header bar across the top with the app name/logo
  - A search input field in the header that filters canvases as you type
  - A "New Canvas" button in the header that creates a new canvas
  - A loading spinner while canvases are being fetched
  - An empty state if user has no canvases yet
  - Two sections: "My Canvases" and "Shared With Me"
  - My Canvases section shows canvases where the user is the owner
  - Shared With Me section shows canvases where user is not the owner (only show if there are any)
  - Each section displays canvases in a responsive grid layout
  - Canvases are sorted by most recently opened first
- **Interactions:**
  - Typing in search immediately updates the filtered results
  - Clicking "New Canvas" opens a modal to name the canvas
  - Clicking any canvas card navigates to that canvas editor
  - Empty state has a call-to-action to create first canvas

### Task 15.10: Create CanvasCard component ✅
- **Files Created:**
  - `src/components/canvas-list/CanvasCard.tsx`
- **What the Card Should Display:**
  - Canvas name prominently at the top
  - Date/time when this canvas was last opened
  - Visual indicator if this is a shared canvas (not owned by current user)
  - Number of other users who have accessed this canvas (optional)
  - A menu button (three dots) in corner if user is the owner
- **Interactions:**
  - Clicking anywhere on card navigates to that canvas
  - Hovering shows slight elevation/shadow effect
  - If user is owner, clicking menu button shows dropdown menu
  - Menu options: Rename, Copy Link, Delete
  - Rename opens a modal to change canvas name
  - Copy Link copies the full canvas URL to clipboard and shows confirmation
  - Delete asks for confirmation then removes the canvas
  - Non-owners see a "Shared" badge instead of menu button

### Task 15.11: Create CreateCanvasModal ✅
- **Files Created:**
  - `src/components/canvas-list/CreateCanvasModal.tsx`
- **What the Modal Should Do:**
  - Display a centered modal dialog over a darkened overlay
  - Show a text input for entering the canvas name
  - Pre-fill the input with "Untitled Canvas"
  - Have Cancel and Create buttons at the bottom
  - Auto-focus the input field when modal opens
  - Disable Create button if name is empty or only whitespace
  - When Create is clicked, create the canvas and navigate to it immediately
  - When Cancel is clicked or user clicks outside modal, close without creating
  - Support closing with Escape key

### Task 15.12: Create RenameCanvasModal ✅
- **Files Created:**
  - `src/components/canvas-list/RenameCanvasModal.tsx`
- **What the Modal Should Do:**
  - Display a centered modal dialog over a darkened overlay
  - Show a text input pre-filled with the current canvas name
  - Have Cancel and Save buttons at the bottom
  - Auto-focus the input and select all text
  - Disable Save button if name is empty or unchanged
  - When Save is clicked, rename the canvas and close the modal
  - Show error message if rename fails
  - When Cancel is clicked or user clicks outside, close without saving
  - Support closing with Escape key

### Task 15.13: Create LoadingSpinner component ✅
- **Files Created:**
  - `src/components/common/LoadingSpinner.tsx`
- **What the Component Should Show:**
  - A spinning animation indicator (circular spinner)
  - Optional text message below the spinner
  - Should center itself vertically and horizontally
  - Support both full-screen mode and inline mode via props
  - Use Tailwind CSS for styling

### Task 15.14: Create EmptyState component ✅
- **Files Created:**
  - `src/components/common/EmptyState.tsx`
- **What the Component Should Show:**
  - A friendly illustration or icon (empty folder, canvas icon, etc.)
  - A headline message explaining the empty state
  - A descriptive subtitle with more context
  - An optional call-to-action button
  - Should center itself in the available space
  - Support different messages for "no canvases" vs "no search results"

---

## Phase 5: Canvas Editor Page (1.5 hours)

### Task 15.15: Create CanvasEditor page component ✅
- **Files Created:**
  - `src/pages/CanvasEditor.tsx`
- **What the Page Should Do:**
  - Extract the canvas ID from the URL parameters
  - If no canvas ID in URL, redirect to home page
  - Fetch the canvas metadata from Firebase to verify it exists
  - Show loading spinner while fetching canvas data
  - If canvas doesn't exist, show error message and redirect to home
  - Record that the current user opened this canvas (update timestamp)
  - Render a top navigation bar with canvas info
  - Render the main canvas area below the nav bar
  - Provide the canvas ID to CanvasContext and PresenceContext as props
  - Use full-screen layout (no scrolling on the page itself)
- **Error Handling:**
  - Handle invalid canvas IDs gracefully
  - Show friendly error message if canvas not found
  - Show error if canvas fails to load
  - Automatically redirect to home after showing error

### Task 15.16: Add top navigation bar to CanvasEditor ✅
- **Files Modified:**
  - `src/pages/CanvasEditor.tsx`
- **What the Nav Bar Should Include:**
  - Fixed/sticky bar across the top (doesn't scroll away)
  - Back arrow button on far left that returns to canvas list
  - Canvas name displayed prominently after back button
  - Canvas name should be clickable to rename (if owner)
  - OnlineUsers component on far right showing who else is present
  - Dark background color to distinguish from canvas below
  - Clear visual separation between nav bar and canvas area
- **Interactions:**
  - Back button has hover state and navigates to home on click
  - Canvas name can be clicked to open rename modal (owner only)
  - Entire nav bar should have consistent height

---

## Phase 6: Update Existing Components (1 hour)

### Task 15.17: Update OnlineUsers component ✅
- **Files Modified:**
  - `src/components/presence/OnlineUsers.tsx`
- **What to Change:**
  - Remove any absolute positioning (will be placed in header now)
  - Change layout to work horizontally in a nav bar
  - Show a compact view: count badge plus first few user indicators
  - Clicking the component opens a dropdown showing full list of online users
  - Dropdown should show each user's email and colored indicator
  - Keep all existing presence tracking logic
  - Keep existing user color assignments
- **Visual Design:**
  - Should fit naturally in a dark navigation bar
  - Should be visually clear when multiple users are present
  - Dropdown should appear below the component when clicked

### Task 15.18: Verify Canvas component isolation ✅
- **Files Modified:**
  - `src/components/canvas/Canvas.tsx` (minimal or no changes)
- **What to Verify:**
  - Canvas component works correctly when CanvasProvider receives canvas ID prop
  - All pan/zoom functionality still works
  - Rectangle creation still works
  - Selection and dragging still work
  - Objects are properly isolated to the current canvas
  - Opening different canvases shows different objects
  - No changes should be needed if CanvasContext was properly updated

### Task 15.19: Verify Toolbar component isolation ✅
- **Files Modified:**
  - `src/components/toolbar/Toolbar.tsx` (minimal or no changes)
- **What to Verify:**
  - Toolbar works correctly with new context structure
  - Color selection still works
  - Delete button still works
  - All toolbar functions operate on correct canvas
  - No changes should be needed if CanvasContext was properly updated

---

## Phase 7: Polish & UX Enhancements (1.5 hours)

### Task 15.20: Add toast notification system ✅
- **Files Created:**
  - `src/components/common/Toast.tsx`
  - `src/contexts/ToastContext.tsx`
  - `src/hooks/useToast.ts`
- **What the System Should Do:**
  - Display temporary notification messages in top-right corner
  - Support different types: success (green), error (red), info (blue)
  - Show icon appropriate to the message type
  - Automatically dismiss after 3 seconds
  - Allow manual dismissal by clicking X button
  - Stack multiple toasts vertically if shown simultaneously
  - Animate in from right and fade out when dismissing
- **When to Use:**
  - Show success when canvas is created
  - Show success when link is copied to clipboard
  - Show success when canvas is deleted
  - Show error if any operation fails
  - Show info for general notifications

### Task 15.21: Add empty state variations ✅
- **Files Modified:**
  - `src/pages/CanvasListPage.tsx`
- **What Empty States to Add:**
  - No canvases at all: "Create your first canvas" with large create button
  - Search returns nothing: "No canvases found matching '[query]'" with suggestion to try different search
  - No shared canvases: Don't show "Shared With Me" section at all
  - Failed to load: Error message with retry button

### Task 15.22: Add copy link confirmation ✅
- **Files Modified:**
  - `src/components/canvas-list/CanvasCard.tsx`
- **What to Add:**
  - When "Copy Link" is clicked from menu, copy full URL to clipboard
  - Show toast notification confirming link was copied
  - URL should be the full path: origin + "/canvas/" + canvasId
  - Use browser's clipboard API to copy
  - Handle clipboard permission errors gracefully

### Task 15.23: Add keyboard shortcuts ✅
- **Files Modified:**
  - `src/pages/CanvasListPage.tsx`
  - `src/pages/CanvasEditor.tsx`
- **What Shortcuts to Add:**
  - On canvas list page: Ctrl/Cmd+K to focus search box
  - On canvas list page: Ctrl/Cmd+N to create new canvas
  - On any page: Escape to close modals or return to list
  - Consider adding "?" to show keyboard shortcuts help modal

### Task 15.24: Add confirmation dialogs ✅
- **Files Created:**
  - `src/components/common/ConfirmDialog.tsx`
- **What the Dialog Should Do:**
  - Show a centered modal with a question/warning message
  - Have two buttons: Cancel (secondary) and Confirm (primary, danger color)
  - Confirm button should be red for destructive actions
  - Support customizing button text
  - Block other interactions until user responds
  - Used for: delete canvas confirmation, leave unsaved work warnings

---

## Phase 8: Testing & Validation (1.5 hours)

### Task 15.25: Create canvas list tests ✅
- **Files Created:**
  - `tests/canvas-list.test.tsx`
- **What to Test:**
  - User can create a new canvas from the list page
  - Created canvas appears in "My Canvases" section immediately
  - User can search for canvases by name
  - Search matches partial names case-insensitively
  - Canvases are sorted by most recently opened
  - User can rename a canvas they own
  - Canvas name updates immediately after rename
  - User can delete a canvas they own
  - Canvas disappears from list immediately after deletion
  - Empty states appear when appropriate

### Task 15.26: Create canvas sharing tests ✅
- **Files Created:**
  - `tests/canvas-sharing.test.tsx`
- **What to Test:**
  - User can navigate to canvas via URL with canvas ID
  - First time opening canvas records user in lastOpenedBy
  - Canvas appears in user's list after opening via URL
  - Canvas appears in "Shared With Me" section if user doesn't own it
  - Multiple users can open same canvas simultaneously
  - Changes made by one user appear for other users in same canvas
  - Objects created in Canvas A don't appear in Canvas B
  - Presence is isolated per canvas (cursors only show for users in same canvas)
  - updateLastOpened is called when canvas is opened

### Task 15.27: Create permission tests ✅
- **Files Created:**
  - `tests/canvas-permissions.test.tsx`
- **What to Test:**
  - Owner can rename their canvas
  - Non-owner cannot rename a shared canvas
  - Owner can delete their canvas
  - Non-owner cannot delete a shared canvas
  - Any authenticated user with URL can read canvas
  - Any authenticated user with URL can create/edit objects in canvas
  - Unauthenticated users cannot access any canvas
  - Firebase security rules properly enforce these permissions

### Task 15.28: Manual testing checklist ✅
- **Manual Tests to Perform:**
  - Create new canvas from list page, verify it appears
  - Search for canvas by partial name, verify filtering works
  - Click canvas to open it
  - Copy canvas URL from menu
  - Open canvas URL in incognito window or different browser
  - Log in as different user and verify canvas is accessible
  - Verify canvas appears in second user's "Shared With Me" section
  - Have both users create objects, verify both see changes in real-time
  - Verify both users see each other's cursors and presence
  - Open two different canvases in separate tabs
  - Create objects in each canvas, verify they're isolated
  - Verify presence is isolated (cursors don't appear across canvases)
  - Delete a canvas, verify it's removed from all users who had accessed it
  - Try to access deleted canvas URL, verify error handling
  - Test search with special characters and edge cases
  - Test with slow network connection
  - Test with 3+ simultaneous users in same canvas

---

## Implementation Decisions & Clarifications

### Core Behaviors

**Canvas Name Length & Validation**
- Maximum length: 60 characters
- Trim whitespace from start and end
- Cannot be empty after trimming
- No special character restrictions

**Canvas Name Editing in Editor**
- Clicking canvas name in nav bar opens RenameCanvasModal
- Same modal component used in list and editor for consistency
- Owner only - non-owners see non-clickable name

**Redirect Behavior**
- After deleting a canvas (as owner): Redirect to canvas list page
- After leaving a canvas (as non-owner): Redirect to canvas list page
- If viewing a canvas and it gets deleted by someone else: Show error toast and redirect to list after 2 seconds
- After creating a canvas: Navigate directly to the new canvas editor

**Search Behavior**
- Debounce search input by 300ms before filtering
- No search persistence - starts fresh when returning to list page
- No "clear search" button - user can manually clear the input
- No search result count displayed

**Error Handling Strategy**
- Network/Firebase errors: Show error toasts (red, 5 seconds)
- Canvas not found: Show page-level error with "Return to Canvas List" button
- Permission denied: Show page-level error with explanation
- Failed operations (create/rename/delete): Show error toast and don't navigate away
- Critical errors: ErrorBoundary catches and shows friendly message

**Copy Link Functionality**
- Available in canvas card menu only
- Not in editor nav bar (keep editor minimal)
- Shows success toast on copy: "Link copied to clipboard"

**Loading States**
- Modal buttons disable and show spinner during async operations
- Canvas cards show subtle loading state during navigation
- List page shows full-page spinner on initial load
- No skeleton loaders (use spinner for simplicity)

**Optimistic Updates**
- Canvas list operations (rename, delete, leave) update immediately in UI
- If operation fails, revert and show error toast
- Canvas objects already use optimistic updates (existing behavior)

### Out of Scope for This PR

**Canvas Thumbnails**
- Remove `thumbnail?: string` from Firebase structure
- Can be added in future PR
- Cards show placeholder icon instead

**Presence Indicators on Cards**
- No "2 users editing now" badges
- No active user indicators on cards
- Presence only visible inside canvas editor

**Advanced Search**
- No filters (by date, by owner, etc.)
- No search history or suggestions
- Just simple name contains matching

**Mobile Touch Gestures**
- Canvas pan/zoom uses existing mouse-based implementation
- No special pinch-to-zoom or touch optimizations
- Basic responsive layout only

### Empty States

**New Canvas**
- No special onboarding or tutorial
- Empty canvas shows immediately (user knows to click/drag from context)
- Toolbar is always visible to guide actions

**Canvas List - No Canvases**
- Illustration: Large canvas/document icon
- Headline: "No canvases yet"
- Subtitle: "Create your first canvas to get started"
- Large "Create Canvas" button as CTA

**Canvas List - No Search Results**
- Illustration: Magnifying glass icon
- Headline: "No canvases found"
- Subtitle: "Try a different search term"
- No CTA button (user can modify search)

**Canvas List - No Shared Canvases**
- Don't show "Shared With Me" section at all
- Only show when user has at least one shared canvas

### Confirmation Dialog Content

**Delete Canvas (Owner)**
- Title: "Delete Canvas?"
- Message: "This will permanently delete '[Canvas Name]' and all its content. This cannot be undone."
- Cancel button: "Cancel" (gray)
- Confirm button: "Delete" (red)

**Leave Canvas (Non-Owner)**
- Title: "Leave Canvas?"
- Message: "Remove '[Canvas Name]' from your list? You can access it again with the link."
- Cancel button: "Cancel" (gray)
- Confirm button: "Leave" (red)

### Browser & Platform Support

**Browsers**
- Chrome 90+ (primary)
- Firefox 88+
- Safari 14+
- Edge 90+
- No IE11 support

**Responsive Design**
- Desktop: Full featured (1280px+)
- Tablet: Grid layout adjusts to 2 columns (768px-1279px)
- Mobile: Single column, basic functionality (< 768px)
- No mobile-specific features (native gestures, etc.)

### Performance Assumptions

**Canvas Limits**
- No hard limit on number of canvases per user
- Assume typical user has < 50 canvases
- If performance degrades with 100+ canvases, can add pagination later

**Data Freshness**
- Canvas list loads once on mount
- No auto-refresh or polling
- User can refresh browser to get latest data
- Canvas editor has real-time sync (existing behavior)

### Toast Notification Behavior

**Duration**
- Success toasts: 3 seconds
- Info toasts: 3 seconds
- Error toasts: 5 seconds (longer to read error messages)
- All toasts can be manually dismissed with X button

**Stacking**
- Multiple toasts stack vertically
- Maximum 3 toasts visible at once
- Oldest toasts auto-dismiss to make room for new ones
- No "dismiss all" button

### URL Edge Cases

**Invalid Canvas ID**
- `/canvas/` (no ID): Redirect to list immediately
- `/canvas/invalid-123` (doesn't exist): Show error page with "Canvas not found" and "Return to Canvas List" button
- `/canvas/valid-id` (after deletion): Same as doesn't exist

**Canvas Access After Leaving**
- Opening URL after leaving silently re-adds to list
- No "Welcome back" message
- No indication that user previously left
- Updates `lastOpenedBy` timestamp as normal

### Keyboard Shortcuts

**Canvas List Page**
- `Ctrl/Cmd + K`: Focus search input
- `Ctrl/Cmd + N`: Open create canvas modal
- `Escape`: Close any open modal

**Canvas Editor Page**
- `Escape`: Deselect objects (existing behavior)
- `Delete/Backspace`: Delete selected object (existing behavior)
- `Escape` (in rename modal): Close modal
- No additional shortcuts in this PR

**Help**
- No keyboard shortcuts help modal in this PR
- Can be added later if needed

### Default Experience

**New User**
- No default "Welcome" canvas created
- User starts with empty canvas list
- Prominent empty state guides them to create first canvas
- First canvas can be created with default name "Untitled Canvas"

---

## Implementation Priorities

### Must Have (Core Functionality)
- [ ] 1. Canvas creation and listing
- [ ] 2. URL-based navigation to canvases
- [ ] 3. Automatic sharing via URL
- [ ] 4. Canvas isolation (objects and presence per canvas)
- [ ] 5. Search by canvas name
- [ ] 6. Owner can rename and delete

### Should Have (Important UX)
- [ ] 7. Sections for "My Canvases" and "Shared With Me"
- [ ] 8. Sort by most recently opened
- [ ] 9. Copy link to clipboard feature
- [ ] 10. Loading and empty states

### Nice to Have (Polish)
- [ ] 11. Toast notifications
- [ ] 12. Confirmation dialogs
- [ ] 13. Keyboard shortcuts
- [ ] 14. Error boundaries and graceful failures

---

## Success Criteria

### Functional Requirements
- [ ] User can create canvas with custom name
- [ ] User can access any canvas via URL
- [ ] Canvas automatically appears in accessing user's list
- [ ] Canvas list shows owned and shared canvases separately
- [ ] Search filters canvases by name
- [ ] Objects are isolated per canvas
- [ ] Presence is isolated per canvas
- [ ] Owner can rename/delete canvas
- [ ] Non-owners can edit but not rename/delete
- [ ] Non-owners can leave shared canvas
- [ ] Canvas removed from user's list after leaving
- [ ] Leaving doesn't affect other users or canvas data

### Performance Requirements
- [ ] Canvas list loads in < 2 seconds
- [ ] Search results update in < 300ms
- [ ] Canvas opens in < 2 seconds
- [ ] No performance degradation with 10+ canvases
- [ ] Real-time sync works across canvases

### User Experience Requirements
- [ ] Clear visual distinction between owned and shared
- [ ] Intuitive navigation between list and editor
- [ ] Obvious way to share canvas (copy link)
- [ ] Helpful empty states and loading indicators
- [ ] Error messages are clear and actionable

---

## Timeline Estimate

- **Friday Evening:** Phase 1-2 (Backend + Contexts) - 3.5 hours
- **Saturday Morning:** Phase 3-4 (Routing + List UI) - 4 hours
- **Saturday Afternoon:** Phase 5-6 (Editor + Component Updates) - 2.5 hours
- **Sunday Morning:** Phase 7-8 (Polish + Testing) - 3 hours

**Total: 13 hours** (including debugging and iteration)

---

## Rollout Plan

### Testing Before Merge
- [ ] Run full test suite (all tests passing)
- [ ] Complete manual testing checklist
- [ ] Test in multiple browsers
- [ ] Test with multiple simultaneous users
- [ ] Test Firebase security rules

### Deployment Steps
- [ ] Deploy database rule changes first
- [ ] Deploy application code
- [ ] Verify production deployment
- [ ] Test sharing flow in production
- [ ] Monitor error logs for issues

### Rollback Plan
If critical issues are found:
- [ ] Keep new code but revert to old routing (direct to canvas)
- [ ] Database structure is backward compatible
- [ ] Old canvas URLs continue to work
- [ ] Can iterate on canvas list separately